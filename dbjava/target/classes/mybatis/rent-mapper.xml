<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC 
	"-//mybatis.org//DTD Mapper 3.0//EN" 
	"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.javabang.repository.RentDAO">
	<insert id="rentInsert" parameterType="rent">
		insert into
			rent(member, category, roomType, address, detailAddress, roomCount, guestCount, bedCount, bathCount, information, title, content, price)
			values(#{member}, #{category}, #{roomType}, #{address}, #{detailAddress}, #{roomCount}, #{guestCount}, #{bedCount}, #{bathCount}, #{information}, #{title}, #{content}, #{price})
	</insert>
	
	<select id="getRentIdx" parameterType="int">
		select max(idx) from rent
	</select>
	
	<insert id="fileInsert" parameterType="hashmap">
		insert into
			rent_img(rent, filePath)
			values(#{rent}, #{filePath})
	</insert>
	
	<select id="selectAll" resultType="rent">
	<!-- 	select R.*, I.filePath from rent R join (select rent, min(filePath) as filePath from rent_img group by rent ) I on r.idx = I.rent -->
	SELECT R.*, I.filePath FROM rent R JOIN ( SELECT ri.rent, MIN(ri.idx) AS min_idx FROM rent_img ri GROUP BY ri.rent ) min_img ON R.idx = min_img.rent JOIN rent_img I ON min_img.min_idx = I.idx
	</select>
	<select id="selectOne" parameterType="int" resultType="rent">
		<!-- select r.*, i.filePath from rent R join Rent_img I on r.idx = i.rent where r.idx = #{idx} -->
		select * from rent where idx = #{idx}	
	</select>
	<select id="selectImg" parameterType="int" resultType="rentImg">
		select * from rent_img where rent = #{idx}
	</select>
</mapper>















